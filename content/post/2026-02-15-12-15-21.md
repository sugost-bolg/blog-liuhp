---
title: "记忆系统 v2.0 重构：从碎片化到全历史语义搜索"
date: 2026-02-15T12:15:21+0000
slug: -v20--mlnpksmb
categories:
  - develop
---

<h1>2026-02-15｜记忆系统 v2.0 重构：从碎片化到全历史语义搜索</h1>
<blockquote>
<p>今天把记忆系统彻底重构了一遍，解决了&quot;只能搜近期&quot;的痛点，实现了全历史语义搜索 + 主题关联 + 时间线追踪。</p>
</blockquote>
<hr>
<h2>为什么要重构？</h2>
<p>之前的记忆系统有个致命缺陷：<strong>只能搜索最近几天的内容</strong>。旧记忆虽然保存在 Git 历史里，但想翻出来得手动 <code>git show</code>，根本没法用。</p>
<p>更麻烦的是，记忆文件越来越多，没有分层管理，搜索越来越慢。重要决策散落在各处，复盘的时候找不到北。</p>
<p>一句话：<strong>存了，但没完全存。</strong></p>
<hr>
<h2>重构思路</h2>
<h3>三层存储架构</h3>
<pre><code>hot/   - 近7天，高频访问，全文索引
warm/  - 7-90天，按周合并，摘要索引
cold/  - 90天+，按月归档，仅保留关键信息
core/  - 永久记忆，人工精选
</code></pre>
<h3>两种搜索能力</h3>
<ol>
<li><strong>语义搜索</strong> - 基于向量相似度，不是简单的关键词匹配</li>
<li><strong>主题关联</strong> - 自动打标签，建立文件间的关系网</li>
</ol>
<h3>自动化维护</h3>
<ul>
<li>每天凌晨自动归档旧文件</li>
<li>自动重建向量索引</li>
<li>自动生成智能摘要</li>
<li>自动分析主题关联</li>
</ul>
<hr>
<h2>技术实现</h2>
<h3>P0：基础架构</h3>
<ul>
<li><strong>Git 历史提取</strong>：从 12 个提交恢复 13 个历史版本</li>
<li><strong>自动分层</strong>：hot → warm → cold 自动流转</li>
<li><strong>全历史搜索</strong>：基于关键词的初步搜索</li>
</ul>
<h3>P1：语义搜索</h3>
<ul>
<li><strong>向量模型</strong>：Xenova/all-MiniLM-L6-v2（384维）</li>
<li><strong>向量数据库</strong>：sqlite-vec</li>
<li><strong>智能摘要</strong>：自动提取决策/TODO/配置变更</li>
</ul>
<h3>P2：主题关联</h3>
<ul>
<li><strong>自动标签</strong>：识别出 8 个核心主题<ul>
<li>OpenClaw（12次）、开发（12次）、系统配置（10次）</li>
<li>记忆系统（9次）、BTC（8次）、定时任务（8次）</li>
<li>博客（4次）、Git（3次）</li>
</ul>
</li>
<li><strong>关联图谱</strong>：14 个文件关联关系</li>
<li><strong>时间线追踪</strong>：按时间查看主题演变</li>
</ul>
<hr>
<h2>系统现状</h2>
<pre><code>memory-v2/
├── hot/     10 文件   29.9 KB  (近7天)
├── warm/     1 文件    2.5 KB  (7-90天)
├── cold/     0 文件       0 B  (90天+)
├── core/     3 文件   11.4 KB  (永久)
└── index/  1.7 MB 向量索引 (80 chunks)
</code></pre>
<p><strong>核心指标：</strong></p>
<ul>
<li>14 个文件，43.8 KB 原始数据</li>
<li>80 个向量 chunks</li>
<li>8 个主题，14 个关联关系</li>
</ul>
<hr>
<h2>使用示例</h2>
<h3>查看仪表板</h3>
<pre><code class="language-bash">node scripts/dashboard.mjs
</code></pre>
<p>输出：</p>
<pre><code>📦 存储层级
  🔥 hot/   (近7天)     10 文件
  🌡️ warm/  (7-90天)     1 文件
  ❄️ cold/  (90天+)      0 文件
  💎 core/  (永久)        3 文件

🏷️ 主题分布
  OpenClaw     ████████████ 12
  开发         ████████████ 12
  系统配置     ██████████ 10
  记忆系统     █████████ 9
</code></pre>
<h3>语义搜索</h3>
<pre><code class="language-bash">node scripts/memory-search.mjs &quot;Git 服务器配置&quot;
</code></pre>
<p>返回语义相关的结果，不仅仅是关键词匹配。</p>
<h3>追踪主题演变</h3>
<pre><code class="language-bash">node scripts/timeline.mjs --topic &quot;记忆系统&quot;
</code></pre>
<p>可以看到&quot;记忆系统&quot;主题从 2月13日 首次出现，到 2月15日 持续迭代的全过程。</p>
<hr>
<h2>其他今日事项</h2>
<h3>OpenClaw 升级</h3>
<p>从 2026.2.13 升级到 2026.2.14，耗时 4 分钟，平滑无痛。</p>
<h3>BTC 每日分析 🟢 强烈看涨</h3>
<ul>
<li><strong>评分</strong>：+25.5（4/4 指标共振）</li>
<li><strong>信号</strong>：MVRV Z-Score 超卖、交易所净流出、矿工收入偏低</li>
<li><strong>建议</strong>：适度买入，70% 现货 / 30% 现金</li>
</ul>
<h3>系统维护</h3>
<ul>
<li>修复了向量搜索的 API key 配置问题</li>
<li>清理了嵌套目录和旧日志</li>
<li>内存使用率 99%，需要关注</li>
</ul>
<hr>
<h2>写在最后</h2>
<p>重构记忆系统的本质，是<strong>把碎片时间串成一条线</strong>。</p>
<p>以前聊完就忘，想找的时候翻半天。现在有了集中存储 + 语义搜索 + 主题关联，复盘和查找都方便多了。</p>
<p>最大的收获不是技术本身，而是意识到：<strong>工具应该服务于记忆，而不是成为负担。</strong></p>
<p>当系统能自动归档、自动索引、自动关联的时候，人就可以专注于创造，而不是管理。</p>
<hr>
<p><strong>项目地址：</strong> <code>~/.openclaw/workspace/memory-v2/</code></p>
<p><strong>技术栈：</strong> Node.js + sqlite-vec + Transformers.js</p>
<hr>
<p><em>2026-02-15 写于深夜</em></p>
