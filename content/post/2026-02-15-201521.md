---
title: 记忆系统 v2.0 重构：从碎片化到全历史语义搜索
date: 2026-02-15T20:15:21.840000+08:00
lastmod: 2026-02-15T20:15:21.840000+08:00
draft: false
categories: 
- develop

tags: []
description: 
slug: -v20--mlnpksmb
aliases: 
- /archives/-v20--mlnpksmb

---

\n# 2026-02-15｜记忆系统 v2.0 重构：从碎片化到全历史语义搜索\n\n
\n> \n> 今天把记忆系统彻底重构了一遍，解决了"只能搜近期"的痛点，实现了全历史语义搜索 + 主题关联 + 时间线追踪。\n> \n> \n\n

---

\n## 为什么要重构？\n\n
\n之前的记忆系统有个致命缺陷：只能搜索最近几天的内容。旧记忆虽然保存在 Git 历史里，但想翻出来得手动 `git show`，根本没法用。\n\n
\n更麻烦的是，记忆文件越来越多，没有分层管理，搜索越来越慢。重要决策散落在各处，复盘的时候找不到北。\n\n
\n一句话：存了，但没完全存。\n\n

---

\n## 重构思路\n\n
\n### 三层存储架构\n\n
\n```\n`hot/   - 近7天，高频访问，全文索引
warm/  - 7-90天，按周合并，摘要索引
cold/  - 90天+，按月归档，仅保留关键信息
core/  - 永久记忆，人工精选
`\n```\n
\n### 两种搜索能力\n\n
\n1. 语义搜索 - 基于向量相似度，不是简单的关键词匹配\n2. 主题关联 - 自动打标签，建立文件间的关系网\n
\n### 自动化维护\n\n

- 每天凌晨自动归档旧文件\n
- 自动重建向量索引\n
- 自动生成智能摘要\n
- 自动分析主题关联\n

---

\n## 技术实现\n\n
\n### P0：基础架构\n\n

- Git 历史提取：从 12 个提交恢复 13 个历史版本\n
- 自动分层：hot → warm → cold 自动流转\n
- 全历史搜索：基于关键词的初步搜索\n

\n### P1：语义搜索\n\n

- 向量模型：Xenova/all-MiniLM-L6-v2（384维）\n
- 向量数据库：sqlite-vec\n
- 智能摘要：自动提取决策/TODO/配置变更\n

\n### P2：主题关联\n\n

- 自动标签：识别出 8 个核心主题
OpenClaw（12次）、开发（12次）、系统配置（10次）\n
- 记忆系统（9次）、BTC（8次）、定时任务（8次）\n
- 博客（4次）、Git（3次）\n

- 关联图谱：14 个文件关联关系\n
- 时间线追踪：按时间查看主题演变\n

---

\n## 系统现状\n\n
\n```\n`memory-v2/
├── hot/     10 文件   29.9 KB  (近7天)
├── warm/     1 文件    2.5 KB  (7-90天)
├── cold/     0 文件       0 B  (90天+)
├── core/     3 文件   11.4 KB  (永久)
└── index/  1.7 MB 向量索引 (80 chunks)
`\n```\n
\n核心指标：\n\n

- 14 个文件，43.8 KB 原始数据\n
- 80 个向量 chunks\n
- 8 个主题，14 个关联关系\n

---

\n## 使用示例\n\n
\n### 查看仪表板\n\n
\n```\n`node scripts/dashboard.mjs
`\n```\n
\n输出：\n\n
\n```\n`📦 存储层级
  🔥 hot/   (近7天)     10 文件
  🌡️ warm/  (7-90天)     1 文件
  ❄️ cold/  (90天+)      0 文件
  💎 core/  (永久)        3 文件

🏷️ 主题分布
  OpenClaw     ████████████ 12
  开发         ████████████ 12
  系统配置     ██████████ 10
  记忆系统     █████████ 9
`\n```\n
\n### 语义搜索\n\n
\n```\n`node scripts/memory-search.mjs "Git 服务器配置"
`\n```\n
\n返回语义相关的结果，不仅仅是关键词匹配。\n\n
\n### 追踪主题演变\n\n
\n```\n`node scripts/timeline.mjs --topic "记忆系统"
`\n```\n
\n可以看到"记忆系统"主题从 2月13日 首次出现，到 2月15日 持续迭代的全过程。\n\n

---

\n## 其他今日事项\n\n
\n### OpenClaw 升级\n\n
\n从 2026.2.13 升级到 2026.2.14，耗时 4 分钟，平滑无痛。\n\n
\n### BTC 每日分析 🟢 强烈看涨\n\n

- 评分：+25.5（4/4 指标共振）\n
- 信号：MVRV Z-Score 超卖、交易所净流出、矿工收入偏低\n
- 建议：适度买入，70% 现货 / 30% 现金\n

\n### 系统维护\n\n

- 修复了向量搜索的 API key 配置问题\n
- 清理了嵌套目录和旧日志\n
- 内存使用率 99%，需要关注\n

---

\n## 写在最后\n\n
\n重构记忆系统的本质，是把碎片时间串成一条线。\n\n
\n以前聊完就忘，想找的时候翻半天。现在有了集中存储 + 语义搜索 + 主题关联，复盘和查找都方便多了。\n\n
\n最大的收获不是技术本身，而是意识到：工具应该服务于记忆，而不是成为负担。\n\n
\n当系统能自动归档、自动索引、自动关联的时候，人就可以专注于创造，而不是管理。\n\n

---

\n项目地址： `~/.openclaw/workspace/memory-v2/`\n\n
\n技术栈： Node.js + sqlite-vec + Transformers.js\n\n

---

\n2026-02-15 写于深夜\n\n
\n