---
title: "通达信配合助手的股票自动交易"
date: 2021-03-09T00:00:00+08:00
draft: false
categories:
  - 随笔
tags: []
---




    {通达信配合助手的股票自动交易}
    LINE:=10;{设置风险价格移动平均线角度}
    N:=7;{设置天数}
    单票准备金:=100000;{设置平均每只股票买的金额}
    ATRN:=EMA(ATR,N),NODRAW;{ATR N天移动平均线}
    LA:=IF(L>REF(C,1),REF(C,1),L),NODRAW;{设置最低价}
    HA:=IF(H>REF(C,1),H,REF(C,1)),NODRAW;{设置最高价}
    CLEAN:=EMA((LA+ATR),10),NODRAW;{风险价格移动平均线}
    LAC:=ATAN((CLEAN/REF(CLEAN,1)-1)*100)*180/3.1416;{计算风险价格移动平均线角度}
    HHVA:=(HHV(H,N)-1.5*ATRN),NODRAW;{最高位回撤控制}
    BD:IF(IF(C>REF(C,1),C,L)<HHVA,0,LAC),NODRAW;{暴跌清仓控制}
    XH:IF(BD!=0,LAC,IF(LAC<LINE,LAC,BD)),NODRAW;{信号}
    S5:=0.95*IF(H>REF(C,1),H,REF(C,1)),NODRAW;{单日跌幅超过5%}
    
    DRAWBAND(XH,RGB(227,23,13),LINE,RGB(0,255,255));{画图}
    DRAWBAND(BD,RGB(227,23,13),LINE,RGB(255,255,0));{画图}
    
    B:=XH>=LINE AND C>(LA+ATRN*0.318) AND DYNAINFO(14)*100<7;{设置开仓条件}
    S:=XH<LINE;{设置清仓条件}
    S2:=C<(HHV(H,2)*0.92);{2日内跌8%}
    
    持仓个数:=TDXDLL1(5, 4, 0, 0),NODRAW;
    可用金额:=TDXDLL1(5, 1, 0, 0),NODRAW;
    可卖数量:=TDXDLL1(3, STR2CON(CODE), 1, 0),NODRAW;
    个股持仓:=TDXDLL1(3, STR2CON(CODE), 0, 0),NODRAW;
    持仓市值:=TDXDLL1(3, STR2CON(CODE), 5, 0),NODRAW;
    账户总持仓市值:=TDXDLL1(5, 2, 0, 0),NODRAW;
    账户总资产:=TDXDLL1(5, 0, 0, 0),NODRAW;
    
    建议监控数量:CEILING(账户总资产/单票准备金),NODRAW;
    
    DRAWTEXT_FIX(账户总资产>0,0.03,0.03,0,'助手已联通'),COLORGREEN;{显示助手是否联通}
    
    买入点:IF(XH>=LINE,(LA+ATRN*0.318),DRAWNULL),NODRAW;
    
    欲买金额:IF(可用金额>单票准备金,单票准备金,可用金额),NODRAW;{建仓金额}
    买入股数:=CEILING(欲买金额/C/100)*100,NODRAW;{设定买入股票的数量}
    
    卖出时间段:=MACHINETIME>=93000 AND MACHINETIME<=150000;{在开盘的时间内}
    买入时间段:=MACHINETIME>=144000 AND MACHINETIME<=150000;{在开盘的时间内}
    
    买入条件:=B AND 买入股数>=100 AND 买入时间段 AND 个股持仓=0,NODRAW;{多层条件控制买入}
    卖出条件2:=(S OR S2) AND 卖出时间段 AND 可卖数量>0;{卖出条件控制}
    
    设定买入价:=TDXDLL1(15, STR2CON(CODE), 0, DYNAINFO(21)+0.01);{设定卖2价买入}
    执行买入1:=TDXDLL1(1, STR2CON(CODE), 1, 买入条件*买入股数);{调用助手买入函数}
    
    设定卖出价:=TDXDLL1(15, STR2CON(CODE), 1, DYNAINFO(20)-0.01);{设定买2价卖出}
    执行卖出2:=TDXDLL1(2, STR2CON(CODE), 2, 卖出条件2*可卖数量);{调用助手卖出函数};

----------


    {通达信配合助手的股票自动交易}
    LINE:=10;{设置风险价格移动平均线角度}
    N:=7;{设置天数}
    单票准备金:=100000;{设置平均每只股票买的金额}
    ATRN:=EMA(ATR,N),NODRAW;{ATR N天移动平均线}
    LA:=IF(L>REF(C,1),REF(C,1),L),NODRAW;{设置最低价}
    HA:=IF(H>REF(C,1),H,REF(C,1)),NODRAW;{设置最高价}
    CLEAN:=EMA((LA+ATR),10),NODRAW;{风险价格移动平均线}
    LAC:=ATAN((CLEAN/REF(CLEAN,1)-1)*100)*180/3.1416;{计算风险价格移动平均线角度}
    HHVA:=(HHV(H,N)-1.5*ATRN),NODRAW;{最高位回撤控制}
    BD:IF(IF(C>REF(C,1),C,L)<HHVA,0,LAC),NODRAW;{暴跌清仓控制}
    XH:IF(BD!=0,LAC,IF(LAC<LINE,LAC,BD)),NODRAW;{信号}
    S5:=0.95*IF(H>REF(C,1),H,REF(C,1)),NODRAW;{单日跌幅超过5%}
    
    DRAWBAND(XH,RGB(227,23,13),LINE,RGB(0,255,255));{画图}
    DRAWBAND(BD,RGB(227,23,13),LINE,RGB(255,255,0));{画图}
    
    B:=XH>=LINE AND C>(LA+ATRN*0.318) AND DYNAINFO(14)*100<7;{设置开仓条件}
    S:=XH<LINE;{设置清仓条件}
    S2:=C<(HHV(H,3)*0.92) OR S5;{3日内价格从最高价跌8%或者当天从最高价格跌5%}
    
    持仓个数:=TDXDLL1(5, 4, 0, 0),NODRAW;
    可用金额:=TDXDLL1(5, 1, 0, 0),NODRAW;
    可卖数量:=TDXDLL1(3, STR2CON(CODE), 1, 0),NODRAW;
    个股持仓:=TDXDLL1(3, STR2CON(CODE), 0, 0),NODRAW;
    持仓市值:=TDXDLL1(3, STR2CON(CODE), 5, 0),NODRAW;
    账户总持仓市值:=TDXDLL1(5, 2, 0, 0),NODRAW;
    账户总资产:=TDXDLL1(5, 0, 0, 0),NODRAW;
    
    建议监控数量:CEILING(账户总资产/单票准备金),NODRAW;
    
    DRAWTEXT_FIX(账户总资产>0,0.03,0.03,0,'助手已联通'),COLORGREEN;{显示助手是否联通}
    
    买入点:IF(XH>=LINE,(LA+ATRN*0.318),DRAWNULL),NODRAW;
    
    欲买金额:IF(可用金额>单票准备金,单票准备金,可用金额),NODRAW;{建仓金额}
    买入股数:=CEILING(欲买金额/C/100)*100,NODRAW;{设定买入股票的数量}
    
    卖出时间段:=MACHINETIME>=93000 AND MACHINETIME<=150000;{在开盘的时间内}
    买入时间段:=MACHINETIME>=100000 AND MACHINETIME<=150000;{在开盘的时间内}
    
    买入条件:=B AND 买入股数>=100 AND 买入时间段 AND 个股持仓=0,NODRAW;{多层条件控制买入}
    卖出条件2:=(S OR S2) AND 卖出时间段 AND 可卖数量>0;{卖出条件控制}
    
    设定买入价:=TDXDLL1(15, STR2CON(CODE), 0, DYNAINFO(21)+0.01);{设定卖2价买入}
    执行买入1:=TDXDLL1(1, STR2CON(CODE), 1, 买入条件*买入股数);{调用助手买入函数}
    
    设定卖出价:=TDXDLL1(15, STR2CON(CODE), 1, DYNAINFO(20)-0.01);{设定买2价卖出}
    执行卖出2:=TDXDLL1(2, STR2CON(CODE), 2, 卖出条件2*可卖数量);{调用助手卖出函数};
