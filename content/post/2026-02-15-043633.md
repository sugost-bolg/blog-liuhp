---
title: 自建Git服务器实现一键重装恢复
date: 2026-02-15T04:36:33.232000+08:00
lastmod: 2026-02-15T04:36:33.232000+08:00
draft: false
categories: 
- develop

tags: []
description: 
slug: git-mlms1h6t
aliases: 
- /archives/git-mlms1h6t

---

\n# 自建Git服务器实现一键重装恢复\n\n
\n最近花了点时间把Mac上的工作环境整理了一下，核心是搭建了一套Git服务器方案，目标是：系统重装后10分钟内完全恢复所有工作配置。\n\n
\n## 背景\n\n
\n平时在Mac mini上跑OpenClaw和一些技能脚本，配置文件、记忆文件、技能代码散落在各处。之前用本地备份脚本，但不够优雅。现在改用Git集中管理，配合Git服务器的匿名访问功能，实现真正的一键恢复。\n\n
\n## 架构\n\n
\n服务器: Debian虚拟机 (10.10.10.230)
客户端: Mac mini (SSH密钥认证)
备份策略: Git + Git Daemon匿名只读\n\n
\n## 仓库设计\n\n
\n设计了4个仓库，各司其职：\n\n
\n||\n||\n||\n||\n||\n||\n\n
\n关键点在于recovery仓库：它包含SSH私钥和恢复脚本，通过Git Daemon提供匿名只读访问。这意味着重装系统后，无需任何认证就能获取私钥，然后自动配置SSH，再拉取其他仓库。\n\n
\n## 服务器配置\n\n
\n### 1. 创建Git用户和仓库\n\n
\n```\n`useradd -m -d /home/git -s /bin/bash git
mkdir -p /srv/git
cd /srv/git

git init --bare openclaw-memory.git
git init --bare openclaw-skills.git
git init --bare openclaw-dotfiles.git
git init --bare openclaw-recovery.git

chown -R git:git /srv/git
`\n```\n
\n### 2. 配置SSH密钥认证\n\n
\n```\n`# Mac上生成密钥
ssh-keygen -t rsa -b 4096 -C "openclaw@macmini"

# 公钥添加到服务器
cat ~/.ssh/id_rsa.pub >> /home/git/.ssh/authorized_keys
`\n```\n
\n### 3. 启用Git Daemon匿名访问\n\n
\n```\n`apt install -y git-daemon-run

cat > /etc/systemd/system/git-daemon.service  ~/.ssh/config /dev/null
cd /tmp/r && ./backup-all.sh

# 或手动分别备份
cd ~/.openclaw/workspace && git add -A && git commit -m "backup" && git push
cd ~/.openclaw/workspace/skills && git add -A && git commit -m "backup" && git push
`\n```\n
\n## 安全考量\n\n
\n这套方案基于内网环境，做了以下权衡：\n\n
\n1. SSH私钥存储在Git仓库中：通过Git Daemon只读暴露，重装时能自动获取\n2. 跳过SSH host key检查：内网环境，简化配置\n3. node_modules不备份：体积大，恢复后重新安装\n
\n如果是公网环境，建议：\n\n

- 私钥改用密码管理器（如1Password）保管\n
- 使用HTTPS + Token方式认证\n
- 启用Git的签名验证\n

\n## 总结\n\n
\n这套方案实现了真正的"一键重装恢复"：\n\n

- 10分钟：从裸机到完全可用\n
- 0干预：全自动执行，无需手动输入\n
- 版本化：所有配置都有Git历史记录\n

\n对于经常折腾系统的开发者来说，这是一套实用的备份策略。\n\n
\n## 仓库地址\n\n
\n```\n`# 匿名只读（恢复用）
git://10.10.10.230/openclaw-recovery.git

# SSH读写（日常使用）
git@10.10.10.230:/srv/git/openclaw-memory.git
git@10.10.10.230:/srv/git/openclaw-skills.git
git@10.10.10.230:/srv/git/openclaw-dotfiles.git
git@10.10.10.230:/srv/git/openclaw-recovery.git
`\n```\n
\n